---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

// Get featured machines
const machines = await getCollection('machines', ({ data }) => data.featured);
const featuredMachines = machines.sort((a, b) => (a.data.order || 99) - (b.data.order || 99)).slice(0, 3);

// Get recent blog posts
const blogPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = blogPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout 
  title="Home Espresso Hub - Find Your Perfect Home Espresso Machine in 2025"
  description="Expert reviews, honest comparisons, and beginner-friendly guides to help you choose the best home espresso machine for your budget and skill level."
>
  <Header />
  
  <!-- Editorial Header -->
  <header class="bg-primary border-b border-gray-100">
    <div class="container-custom section-padding">
      <div class="max-w-3xl">
        <h1 class="text-text mb-6">
          Home Espresso Machine Reviews & Buying Guide
        </h1>
        <p class="text-lg text-gray-600 leading-relaxed mb-8">
          Independent testing and expert analysis to help you choose the right espresso machine. 
          Our team has reviewed over 50 machines across every price range and brewing method.
        </p>
        <nav class="flex gap-8 text-sm">
          <a href="/guide/complete-home-espresso-guide" class="btn-primary">
            Complete Guide
          </a>
          <a href="/blog" class="btn-secondary">
            Latest Reviews
          </a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Featured Reviews Section -->
  <section class="section-padding bg-primary">
    <div class="container-custom">
      <div class="mb-16">
        <h2 class="text-text mb-4">
          Featured Reviews
        </h2>
        <p class="text-gray-600 max-w-2xl">
          Our top picks based on extensive testing across different categories and price points.
        </p>
      </div>

      <div class="space-y-8">
        {featuredMachines.map(machine => (
          <article class="card">
            <div class="grid md:grid-cols-4 gap-8 items-start">
              <div>
                <img 
                  src={machine.data.image} 
                  alt={machine.data.name}
                  class="w-full h-32 object-contain"
                />
              </div>
              <div class="md:col-span-3">
                <h3 class="text-xl font-semibold text-text mb-2">
                  <a href={`/machines/${machine.slug}`} class="hover:text-accent">
                    {machine.data.name}
                  </a>
                </h3>
                <p class="text-gray-600 mb-4 leading-relaxed">
                  {machine.data.benefitDescription}
                </p>
                <div class="flex items-center gap-6 text-sm text-gray-500">
                  <span>Rating: {machine.data.rating}/5</span>
                  <span>${machine.data.price}</span>
                  <a href={`/machines/${machine.slug}`} class="text-accent">
                    Read full review
                  </a>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>

      <div class="mt-16 text-center">
        <a href="/machines" class="btn-primary">
          View all machine reviews
        </a>
      </div>
    </div>
  </section>

  <!-- Latest Articles Section -->
  <section class="section-padding bg-gray-50">
    <div class="container-custom">
      <div class="mb-16">
        <h2 class="text-text mb-4">
          Latest Articles
        </h2>
      </div>

      <div class="space-y-8">
        {recentPosts.map(post => (
          <article class="bg-primary p-8 border-b border-gray-100">
            <div class="max-w-3xl">
              <h3 class="text-xl font-semibold text-text mb-3">
                <a href={`/blog/${post.slug}`} class="hover:text-accent">
                  {post.data.title}
                </a>
              </h3>
              <p class="text-gray-600 mb-4 leading-relaxed">
                {post.data.description}
              </p>
              <div class="flex items-center gap-4 text-sm text-gray-500">
                <time>
                  {new Date(post.data.pubDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
                <a href={`/blog/${post.slug}`} class="text-accent">
                  Continue reading
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>